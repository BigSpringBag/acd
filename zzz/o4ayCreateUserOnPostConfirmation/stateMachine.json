{
  "Comment": "Insert User Record via AppSync on PostConfirmation",
  "StartAt": "Choice State",
  "States": {
    "Choice State": {
      "Type": "Choice",
      "Choices": [
        {
          "And": [
            {
              "Variable": "$.input.email.to",
              "IsPresent": true
            },
            {
              "Variable": "$.input.email.to",
              "IsNull": false
            },
            {
              "Variable": "$.input.email.to[0]",
              "StringGreaterThan": ""
            }
          ],
          "Next": "Insert User"
        }
      ],
      "Default": "Pass State"
    },
    "Pass State": {
      "Type": "Pass",
      "End": true
    },
    "Insert User": {
      "Type": "Task",
      "Resource": "${lambdaArn}",
      "Parameters": {
        "email.$": "$.input.email",
        "dueDate.$": "$.input.dueDate"
      },
      "Retry": [
        {
          "ErrorEquals": ["CustomError"],
          "IntervalSeconds": 1,
          "MaxAttempts": 2,
          "BackoffRate": 2
        },
        {
          "ErrorEquals": ["States.TaskFailed"],
          "IntervalSeconds": 30,
          "MaxAttempts": 2,
          "BackoffRate": 2
        },
        {
          "ErrorEquals": ["States.ALL"],
          "IntervalSeconds": 5,
          "MaxAttempts": 5,
          "BackoffRate": 2
        }
      ],
      "End": true
    }
  }
}
