{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Description": "An example template with an IAM role for a Lambda state machine.",
	"Parameters": {
		"CloudWatchRule": {
			"Type": "String",
			"Default": "NONE",
			"Description": " Schedule Expression"
		},
		"env": {
			"Type": "String"
		},
		"functionacdSendSESLambdaArn": {
			"Type": "String"
		}
	},
	"Resources": {
		"StatesExecutionRole": {
			"Type": "AWS::IAM::Role",
			"Properties": {
				"AssumeRolePolicyDocument": {
					"Version": "2012-10-17",
					"Statement": [
						{
							"Effect": "Allow",
							"Principal": {
								"Service": [
									{
										"Fn::Sub": "states.${AWS::Region}.amazonaws.com"
									}
								]
							},
							"Action": "sts:AssumeRole"
						}
					]
				},
				"Path": "/",
				"Policies": [
					{
						"PolicyName": "StatesExecutionPolicy",
						"PolicyDocument": {
							"Version": "2012-10-17",
							"Statement": [
								{
									"Effect": "Allow",
									"Action": [
										"lambda:InvokeFunction"
									],
									"Resource": "*"
								}
							]
						}
					}
				]
			}
		},
		"MyStateMachine": {
			"Type": "AWS::StepFunctions::StateMachine",
			"Properties": {
				"DefinitionString": {
					"Fn::Sub": [
						"{\"Comment\":\"Send email with delay\",\"StartAt\":\"Init\",\"States\":{\"Init\":{\"Comment\":\"Just to initialized the state machine\",\"Type\":\"Pass\",\"Next\":\"WaitUntil\"},\"WaitUntil\":{\"Type\":\"Wait\",\"TimestampPath\":\"$.dueDate\",\"Next\":\"SendEmail\"},\"SendEmail\":{\"Type\":\"Task\",\"Resource\":\"${lambdaArn}\",\"End\":true}}}",
						{
							"lambdaArn": {
								"Ref": "functionacdSendSESLambdaArn"
							}
						}
					]
				},
				"RoleArn": {
					"Fn::GetAtt": [
						"StatesExecutionRole",
						"Arn"
					]
				}
			}
		}
	}
}